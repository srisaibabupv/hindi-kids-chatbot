function startListening() {
  recognizer.start();
}

recognizer.onresult = (event) => {
  const userAnswer = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
  const node = story[currentId];

  // Match spoken answer
  let matched = null;
  for (let ans of node.expectedAnswers) {
    if (userAnswer.includes(ans.toLowerCase())) {
      matched = ans;
      break;
    }
  }

  if (matched) {
    speak(`शाबाश! तुमने कहा: ${matched}`);
    currentId = node.next[matched];
    setTimeout(() => {
      showStory(currentId); // narrate next node
    }, 1500);
  } else {
    speak("कोशिश करो! सही उत्तर दो।");
    // Continue listening automatically
  }
};

// Start the story and listening loop
showStory(currentId);
startListening();
