<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Voice-Driven Hindi Story</title>
<style>
  body { font-family: Arial; text-align: center; padding: 20px; background: #fff0f5; }
  #story { font-size: 24px; margin: 20px auto; padding: 20px; width: 90%; min-height: 150px; background: #fff3e6; border-radius: 15px; box-shadow: 2px 2px 12px rgba(0,0,0,0.2); }
  button { font-size: 20px; padding: 15px 30px; margin: 10px; border: none; border-radius: 10px; cursor: pointer; background-color: #ff9966; color: white; }
  button:hover { background-color: #ff6600; }
</style>
</head>
<body>

<h1>üé§ Voice-Driven Hindi Story</h1>
<div id="story">‡§ï‡§π‡§æ‡§®‡•Ä ‡§µ‡•á‡§¨ ‡§∏‡•á ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</div>
<button id="startBtn">‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü ‡§∏‡•ç‡§ü‡•ã‡§∞‡•Ä</button>

<script>
let storyData = [];
let currentId = 0;

// ===== Speech Recognition Setup =====
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
  alert("‡§Ü‡§™‡§ï‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§µ‡•â‡§á‡§∏ ‡§∞‡§ø‡§ï‡§ó‡•ç‡§®‡§ø‡§∂‡§® ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡•ç‡§∞‡•ã‡§Æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§");
}
const recognizer = new SpeechRecognition();
recognizer.lang = 'hi-IN';
recognizer.continuous = false;
recognizer.interimResults = false;

// ===== TTS Function =====
function speak(text, callback) {
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = 'hi-IN';
  msg.onend = () => { if(callback) callback(); };
  window.speechSynthesis.speak(msg);
}

// ===== Fetch Story from Web =====
const storyURL = "https://yourdomain.com/story.json"; // Replace with your web-hosted JSON

fetch(storyURL)
  .then(res => res.json())
  .then(data => {
    storyData = data;
    document.getElementById('story').innerHTML = "‡§ï‡§π‡§æ‡§®‡•Ä ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§ ‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§";
  })
  .catch(err => {
    document.getElementById('story').innerHTML = "‡§ï‡§π‡§æ‡§®‡•Ä ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§";
    console.error(err);
  });

// ===== Utility =====
function getNodeById(id) {
  return storyData.find(node => node.id === id);
}

// ===== Show Story Node =====
function showStory(id) {
  const node = getNodeById(id);
  if (!node) return;

  document.getElementById('story').innerHTML = node.text;

  if (!node.expectedAnswers || node.expectedAnswers.length === 0) {
    speak("‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§");
    return;
  }

  speak(node.text, () => { listenAnswer(); });
}

// ===== Listen to Answer =====
function listenAnswer() {
  recognizer.start();
}

recognizer.onresult = (event) => {
  const userAnswer = event.results[0][0].transcript.trim().toLowerCase();
  const node = getNodeById(currentId);

  let matched = node.expectedAnswers.find(ans => userAnswer.includes(ans.toLowerCase()));

  if (matched) {
    speak(`‡§∂‡§æ‡§¨‡§æ‡§∂! ‡§§‡•Å‡§Æ‡§®‡•á ‡§ï‡§π‡§æ: ${matched}`, () => {
      currentId = node.next[matched];
      showStory(currentId);
    });
  } else {
    speak("‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•ã! ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•ã‡•§", () => {
      listenAnswer();
    });
  }
};

recognizer.onerror = (event) => { listenAnswer(); };

// ===== Start Button =====
document.getElementById('startBtn').onclick = () => {
  if (storyData.length === 0) {
    alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§µ‡•á‡§¨ ‡§∏‡•á ‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§¶‡•á‡§Ç‡•§");
    return;
  }
  currentId = storyData[0].id;
  showStory(currentId);
};
</script>
</body>
</html>
