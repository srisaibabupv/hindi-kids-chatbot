<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Interactive Voice Hindi Story</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background: linear-gradient(to bottom, #fffae6, #ffe6f0);
    }
    #story {
      font-size: 24px;
      margin: 20px auto;
      padding: 20px;
      width: 90%;
      min-height: 150px;
      background: #fff3e6;
      border-radius: 15px;
      box-shadow: 2px 2px 12px rgba(0,0,0,0.2);
    }
    button {
      font-size: 20px;
      padding: 15px 30px;
      margin: 10px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #ff9966;
      color: white;
    }
    button:hover {
      background-color: #ff6600;
    }
  </style>
</head>
<body>

<h1>üé§ Interactive Hindi Story</h1>
<div id="story">‡§ï‡§π‡§æ‡§®‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>
<button id="startBtn">‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü ‡§∏‡•ç‡§ü‡•ã‡§∞‡•Ä</button>

<script>
  const storyDiv = document.getElementById('story');
  const startBtn = document.getElementById('startBtn');

  // ===== Story Nodes =====
  const story = {
    1: {
      text: "‡§∞‡§æ‡§ú‡•Ç ‡§ú‡§Ç‡§ó‡§≤ ‡§Æ‡•á‡§Ç ‡§ñ‡•á‡§≤ ‡§∞‡§π‡§æ ‡§•‡§æ‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§µ‡§π ‡§™‡•á‡§°‡§º ‡§™‡§∞ ‡§ö‡§¢‡§º‡•á‡§ó‡§æ ‡§Ø‡§æ ‡§®‡§¶‡•Ä ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§ú‡§æ‡§è‡§ó‡§æ?",
      question: "‡§§‡•Å‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§∏‡•ã‡§ö‡§§‡•á?",
      expectedAnswers: ["‡§™‡•á‡§°‡§º", "‡§®‡§¶‡•Ä"],
      next: {"‡§™‡•á‡§°‡§º": 2, "‡§®‡§¶‡•Ä": 3}
    },
    2: {
      text: "‡§∞‡§æ‡§ú‡•Ç ‡§™‡•á‡§°‡§º ‡§™‡§∞ ‡§ö‡§¢‡§º ‡§ó‡§Ø‡§æ ‡§î‡§∞ ‡§è‡§ï ‡§™‡§ï‡•ç‡§∑‡•Ä ‡§¶‡•á‡§ñ‡§æ‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§µ‡§π ‡§™‡§ï‡•ç‡§∑‡•Ä ‡§ï‡•ã ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§ó‡§æ?",
      question: "‡§ï‡•ç‡§Ø‡§æ ‡§µ‡§π ‡§™‡§ï‡•ç‡§∑‡•Ä ‡§ï‡•ã ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§ó‡§æ?",
      expectedAnswers: ["‡§π‡§æ‡§Å", "‡§®‡§π‡•Ä‡§Ç"],
      next: {"‡§π‡§æ‡§Å": 4, "‡§®‡§π‡•Ä‡§Ç": 5}
    },
    3: {
      text: "‡§∞‡§æ‡§ú‡•Ç ‡§®‡§¶‡•Ä ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§ó‡§Ø‡§æ ‡§î‡§∞ ‡§Æ‡§õ‡§≤‡•Ä ‡§¶‡•á‡§ñ‡•Ä‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§µ‡§π ‡§Æ‡§õ‡§≤‡•Ä ‡§ï‡•ã ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§ó‡§æ?",
      question: "‡§ï‡•ç‡§Ø‡§æ ‡§µ‡§π ‡§Æ‡§õ‡§≤‡•Ä ‡§ï‡•ã ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§ó‡§æ?",
      expectedAnswers: ["‡§π‡§æ‡§Å", "‡§®‡§π‡•Ä‡§Ç"],
      next: {"‡§π‡§æ‡§Å": 6, "‡§®‡§π‡•Ä‡§Ç": 7}
    },
    4: {text: "‡§∞‡§æ‡§ú‡•Ç ‡§®‡•á ‡§™‡§ï‡•ç‡§∑‡•Ä ‡§ï‡•ã ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡•Ä ‡§î‡§∞ ‡§µ‡§π ‡§â‡§°‡§º ‡§ó‡§Ø‡§æ‡•§ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!", expectedAnswers: [], next: {}},
    5: {text: "‡§∞‡§æ‡§ú‡•Ç ‡§®‡•á ‡§™‡§ï‡•ç‡§∑‡•Ä ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡§æ ‡§Ü‡§®‡§Ç‡§¶ ‡§≤‡§ø‡§Ø‡§æ‡•§ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!", expectedAnswers: [], next: {}},
    6: {text: "‡§∞‡§æ‡§ú‡•Ç ‡§®‡•á ‡§Æ‡§õ‡§≤‡•Ä ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡•Ä ‡§î‡§∞ ‡§µ‡§π ‡§¨‡§ö ‡§ó‡§à‡•§ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!", expectedAnswers: [], next: {}},
    7: {text: "‡§∞‡§æ‡§ú‡•Ç ‡§®‡•á ‡§Æ‡§õ‡§≤‡•Ä ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡§æ ‡§Ü‡§®‡§Ç‡§¶ ‡§≤‡§ø‡§Ø‡§æ‡•§ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!", expectedAnswers: [], next: {}}
  };

  let currentId = 1;

  // ===== SpeechRecognition Setup =====
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("‡§Ü‡§™‡§ï‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§µ‡•â‡§á‡§∏ ‡§∞‡§ø‡§ï‡§ó‡•ç‡§®‡§ø‡§∂‡§® ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡•ç‡§∞‡•ã‡§Æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§");
  }
  const recognizer = new SpeechRecognition();
  recognizer.lang = 'hi-IN';
  recognizer.continuous = false; // will manually restart
  recognizer.interimResults = false;

  // ===== Text-to-Speech =====
  function speak(text, callback) {
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'hi-IN';
    msg.onend = () => { if (callback) callback(); };
    window.speechSynthesis.speak(msg);
  }

  // ===== Show Story Node =====
  function showStory(id) {
    const node = story[id];
    storyDiv.innerHTML = node.text;
    if (!node.expectedAnswers || node.expectedAnswers.length === 0) {
      speak("‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§");
      return;
    }
    speak(node.text, () => {
      listenAnswer(); // start listening after narration
    });
  }

  // ===== Listen for Answer =====
  function listenAnswer() {
    recognizer.start();
  }

  recognizer.onresult = (event) => {
    const userAnswer = event.results[0][0].transcript.trim().toLowerCase();
    const node = story[currentId];

    let matched = node.expectedAnswers.find(ans => userAnswer.includes(ans.toLowerCase()));

    if (matched) {
      speak(`‡§∂‡§æ‡§¨‡§æ‡§∂! ‡§§‡•Å‡§Æ‡§®‡•á ‡§ï‡§π‡§æ: ${matched}`, () => {
        currentId = node.next[matched];
        showStory(currentId);
      });
    } else {
      speak("‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•ã! ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•ã‡•§", () => {
        listenAnswer(); // keep listening
      });
    }
  };

  recognizer.onerror = (event) => {
    // restart listening on error
    listenAnswer();
  };

  // ===== Start Button =====
  startBtn.onclick = () => {
    currentId = 1;
    showStory(currentId);
  };
</script>

</body>
</html>
